# WebRTC

### WebRTC란?

- WebRTC(Web Real-Time Communication)는 웹 브라우저 간에 플러그인의 도움 없이 서로 통신할 수 있도록 설계된 API이다. W3C에서 제시된 초안이며, 음성 통화, 영상 통화, P2P 파일 공유 등으로 활동될 수 있다.

### 특징

- 웹에서 사용할 수 있는 유일한 P2P 기술이다.
- 각각의 기기가 서버 도움없이 연결되기 위해 이 연결을 도와주는 서버가 필요하고 P2P 연결이 불가능한 상황을 대비한 릴레이 서버(TURN)가 필요하다.
- UCP(User Datagram Protocol) 기반의 스트리밍 기술이다. HTTP/3 이전까지는 거의 유일한 UDP 기반의 웹 표준이었지만 WebRTC를 이용한 스트리밍은 현존하는 기술 중 Latency가 가장 짧은 것 중 하나가 되었다.
- 위의 특징들로 인해 어떤 기술보다 빠르게 음성과 영상을 전송할 수 있다.

### 활용 분야

- 1:1
  - 원격 의료, 드론, 로봇 및 원격상담, 교육 ...
- 1:N
  - 라이브 커머스, 웨비나, 온라인 종교행사, 라이브사이니지 ...
- N:N
  - 라이브 학습, 원격공연, 라이브게임, 워키토키 ...

### 주요 함수

- MediaStream
  - 카메라/마이크/데이터를 접근하기 위한 스트림 정보
  - `navigator.mediaDevices.getUserMedia(...)`
- getUserMedia
  - 오디오와 비디오 미디어를 가져온다
- RTCPeerConnetion
  - 피어간 오디오, 비디오 통신을 활성한다. 신호 처리, 코덱관리, P2P 통신, 보안, 대역폭 관리를 수행한다.
  - 실제 구현시 해당 커넥션을 내 커넥션 정보와 상대방 커넥션 정보를 각자 구현한다.
- RTCDataChannel
  - 피어 간 양방향 임의 데이터 통신을 허용한다. 웹소켓과 동일한 API를 사용하며 매우 낮은 레이턴시를 보인다.
- getStats
  - 웹 애플리케이션에 WebRTC 세션에 관한 통계 집합의 검색을 허용한다. 이 통계 데이터는 별도의 W3C 문서에 기술되어 있다.

### 핵심 기술

- WebRTC 시그널링 서버 구축
  - 백단에서 서로의 SDP라 불리는 데이터를 서로에게 전달하면서 영상과 미디어 그리고 데이터를 전달하게 하는 기능을 만들어 줘야한다.
  - SDP
    - Session Description Protocol의 약자로, 연결 정보를 모두 갖고 있는 포맷

### 알면 좋을 지식

- ICE(Interactive Connectivity Establishment)
  - 브라우저 환경에서 Peer를 통해 연결 가능하도록 도와주는 프레임워크라고 보면 된다. 그 내부에서 STUN/TURN 서버가 있다.
  - 중요 조건
    - 방화벽 통과
    - Public IP 없을 시 IP 대신 주소값 할당
    - 라우터가 Peer간 직접 연결을 처리가 가능한 상황이어야한다.
- STUN 서버
  - 클라이언트 자신의 퍼블릭 아이피를 제공하여 통신하는 방법
  - 피어가 STUN 서버에 영상/미디어/데이터를 통신할 아이피를 요청해서 해당 아이피를 받아서 서로 통신한다.
- TURN 서버
  - NAT의 제한이 있는 경우 우회하는 서버
  - STUN을 통해서 퍼블릭 아이피가 아무 의미 없는 경우가 있다. 이런 경우 피어간의 통신 과정에서 TURN 서버를 끼고 해당 서버에 데이터를 전달하고 받아오는 방식

### WebRTC 통신 구성 방식

- 1:1 통신 / P2P
  - signal 서버를 통해서 통신 정보만을 교환하는 방식
- 1:N(N:M) 통신 / P2P
  - signal 서버를 통해 통신 정보만을 교환하는 방식
  - 다만 이러한 경우 클라이언트의 부담이 커질 수도 있다.
- 1:N(N:M) 통신 / SFU(selective forwwarding unit)
  - 서버에 정보를 보내고 서버의 데이터를 제공해주는 방식
- 1:N (N:M) 통신 / MCU(multi point control unit)
  - 데이터를 서버로 분리해서 보내고 그걸 다시 조합해서 전달하는 방식으로 클라이언트의 부담은 줄지만 서버의 부담이 크다.
  - 싱크가 발생할 수도 있다.

### 기술의 어려움

- 네트워크 환경에 따른 품질의 불확실성
  - 품질을 보정하는 기술이 내장되어 있지만, 네트워크 기술에 대한 이해와 충분한 개발 경험이없다면 개발에 성공하더라도 안정적인 품질을 보장할 수 없을 것이다.
- 고난이도의 미디어 처리 영역
  - 송출에서 Origin에 이르는 부분과 Edge에서 수신에 이르는 과정만이 WebRTC가 관여하는 부분이고 나머지는 모두 각자의 플랫폼과 각자의 방식으로 구현하거나 감안해야한다.
- 대용량 처리 및 클라우드
  - AWS나 GCP와 같은 클라우드 서비스등을 WebRTC 미디어 서버에 적합하게 아키텍처를 구성하기는 여의치않다.

### WebRTC 응용

- CPaaS
  - WebRTC 기술과 인프라를 전문적으로 제공하는 CPaaS(Communication Platform as a Service)를 활용하고 있다.
  - WebRTC 응용 서비스에서 성공을 결정하는 핵심음 WebRTC 콘텐츠 자체이기 때문에 클라우드 기업에 맡기는 경우가 많다.
- 직접 WebRTC 개발에 도전하기
