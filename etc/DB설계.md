# DB 설계

## DB 설계
### DB 설계의 목적
- 프로젝트, 명세서 등의 정보 요구사항에 대한 정확한 이해
- 분석자, 개발자, 사용자간의 원활한 의사소통 수단
- 데이터 중심의 분석 방법
- 현행 시스템만이 아닌 신규 시스템 개발의 기초 제공

### 설계를 위한 요구사항 분석
* 데이터 베이스에 대한 사용자의 요구사항을 수집하고 분석해서 아래와 같이 요구사항(기능) 명세서를 작성

### 개념적 설계
* 작성한 요구사항 명세서에서 데이터베이스를 구성하는데 필요한 개체, 속성, 개체 간의 관계를 추출하여 ERD 생성
1. 개체(Entity)와 속성(Attribute)을 추출한다.
    * 대부분 명사로 선별한다
2. 개체간의 관계(Relationship)를 추출한다.
    * 대부분 동사로 선별한다(개체간의 관계를 나타내는 동사이어야한다)
    * 관계에 속한 속성도 있을 수 있다
    * 1:1, 1:N, N:M
    * 필수적인 참여, 선택적인 참여

### 개체와 속성 추출
* 요구사항에서 개체는 대부분 명사로 이루어져있지만, 속성과 구별하여 추출한다

### 논리적 설계
* 모든 개체는 릴레이션(Table)으로 변환
  * ER 다이어그램의 각 개체를 릴레이션으로 변환.
  * 개체 -> 테이블속성 -> 테이블의 속성
* N:M 관계는 릴레이션으로 변환
  * 관계 -> 릴레이션 이름, 관게속성 -> 릴레이션 속성
* 1:N 관게는 외래키로 표현
  * 일반적으로 1:N 관계에서 1측 개체의 기본키를 N측 릴레이션에 포함시키고 외래키(FK)로 지정
* 1:1 관계는 외래키로 표현
  * 일반적 1:1 관계는 외래키(FK)를 서로 주고 받는다
* 다중값 속성은 독립 릴레이션으로 변환
  * 릴레이션에서는 다중 값 속성을 가질 수 없으므로 다중 값 속성은 별도의 릴레이션으로 생성해야함

## 물리적 스키마 및 구현
* ERD를 실제 테이블로 생성한다(Workbench 같은 DB Tool 이나 SQL 스크립트 사용으로도 가능해야함)

## DB 정규화
### DB 정규화
* 데이터 모델의 중복을 최소화하고 데이터의 일관성, 유연성을 확보하기 위한 목적으로 데이터를 분해하는 과정
* 제 1 정규화
  * 속성의 원자성을 확보하고 원자값이 아닌 도메인을 분해한다
* 제 2 정규화
  * 기본키가 2개이상의 속성으로 이루어진 경우, 부분 함수 종속성을 제거한다.
* 제 3 정규화
  * 기본키를 제외한 컬럼간의 종속성을 제거한다. 즉 이행함수 종속성을 제거한다
* BCNF
  * 기본키를 제외하고 후보키가 있는 경우 후보키가 기본키를 종속시키면 분해한다
* 제 4 정규화
  * 여러 컬럼들이 하나의 컬럼을 종속시키는 경우 분해하여 다중값 종속성을 제거한다
* 제 5정규화
조인에 의해서 종속성이 발생하는 경우 분해한다

### 반정규화(역정규화)
* 정규화된 엔티티타입, 속성, 관계를 시스템의 성능향상, 개발과 운영의 단순화를 위해 모델을 통합하는 프로세스
* 방법
  * 1:1 관계의 테이블 병합
  * 1:N 관계의 테이블 병합
  * 슈퍼/서브 타입 테이블 병합
  * 수직 분할(집중화된 일부 컬럼을 분리)
  * 수평 분할(행으로 구분하여 구간별 분리)
  * 테이블 추가(중복 테이블, 통계테이블, 이력케이블, 부분테이블)
### 컬럼 반정규화
* 중복 컬럼 추가(자주 조회하는 컬럼이 있는 경우)
* 파생 컬럼 추가(미리 계산한 값)
* PK에 의한 컬럼 추가
* 응용시스템 오작동을 위한 컬럼 추가(이전데이터 임시 보관)

### 관계 반정규화
* 중복관계 추가(이미 A테이블에서 C테이블의 정보를 읽을 수 있는 관계가 있음에도 관계를 중복하여 조회 경로를 단축)